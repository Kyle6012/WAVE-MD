const nmap = require('node-libnmap');

async function scanTarget(target, portRange) {
    return new Promise((resolve, reject) => {
        const options = {
            range: [target],
            ports: portRange
        };

        nmap.scan(options, (err, report) => {
            if (err) {
                reject(err);
            } else {
                const openPorts = [];
                for (let host in report) {
                    if (report[host].openPorts) {
                        report[host].openPorts.forEach(port => {
                            openPorts.push({
                                port: port.port,
                                protocol: port.protocol
                            });
                        });
                    }
                }
                resolve(openPorts);
            }
        });
    });
}

module.exports = scanTarget;

