const dns = require('dns');
const fs = require('fs');
const path = require('path');

// Set the path to your subdomains.txt file
const subdomainsFilePath = path.resolve(__dirname, 'subdomains.txt');

async function checkSubdomain(domain, subdomain) {
    const fullDomain = `${subdomain}.${domain}`;
    return new Promise((resolve) => {
        dns.resolve4(fullDomain, (err, addresses) => {
            if (err) {
                resolve(null);
            } else {
                resolve({ subdomain: fullDomain, addresses });
            }
        });
    });
}

async function discoverSubdomains(domain) {
    const subdomains = fs.readFileSync(subdomainsFilePath, 'utf-8').split('\n').map(sd => sd.trim()).filter(Boolean);
    const results = [];

    for (const subdomain of subdomains) {
        try {
            const result = await checkSubdomain(domain, subdomain);
            if (result) {
                results.push(result);
            }
        } catch (error) {
            console.error(`Error checking subdomain ${subdomain}.${domain}:`, error);
        }
    }

    return results;
}

module.exports = discoverSubdomains;
